package org.sasanlabs.service.vulnerability.openRedirect;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.*;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mockito;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;

class Http3xxStatusCodeBasedInjectionTest {
    private Http3xxStatusCodeBasedInjection http3xxStatusCodeBasedInjection;
    private static final String LOCATION_HEADER_KEY = "Location";

    @BeforeEach
    void setUp() {
        http3xxStatusCodeBasedInjection = Mockito.spy(new Http3xxStatusCodeBasedInjection());
    }

    @Test
    void getVulnerablePayloadLevel1() {
        String url = "/hello";
        ResponseEntity<?> responseEntity =
                http3xxStatusCodeBasedInjection.getVulnerablePayloadLevel1(url);
        assertStatusAndValidate(responseEntity, url);
    }

    private void assertStatusAndValidate(ResponseEntity<?> responseEntity, String url) {
        assertThat(responseEntity.getHeaders().get(LOCATION_HEADER_KEY).contains(url)).isTrue();
        assertThat(responseEntity.getStatusCode()).isEqualTo(HttpStatus.FOUND);
    }

    @Test
    void getVulnerablePayloadLevel2() {}

    @Test
    void getVulnerablePayloadLevel3() {}

    @Test
    void getVulnerablePayloadLevel4() {}

    @Test
    void getVulnerablePayloadLevel5() {}

    @Test
    void getVulnerablePayloadLevel6() {}

    @Test
    void getVulnerablePayloadLevel7() {}

    @Test
    void getVulnerablePayloadLevel8() {}
}
